# Validate Observability Stack Configurations
# Runs on Pull Requests to ensure configs are valid

name: Validate Configs

on:
  pull_request:
    branches: [main]
    paths:
      - 'prometheus/**'
      - 'alertmanager/**'
      - 'loki/**'
      - 'docker-compose.yml'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate Prometheus config
        run: |
          docker run --rm -v ${{ github.workspace }}/prometheus:/etc/prometheus \
            prom/prometheus:v2.51.0 \
            promtool check config /etc/prometheus/prometheus.yml

      - name: Validate Alertmanager config
        run: |
          docker run --rm -v ${{ github.workspace }}/alertmanager:/etc/alertmanager \
            prom/alertmanager:v0.27.0 \
            amtool check-config /etc/alertmanager/alertmanager.yml

      - name: Validate Docker Compose
        run: |
          docker compose config --quiet

      - name: Lint YAML files
        uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: .
          config_file: .yamllint.yml
        continue-on-error: true
